<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Insert title here</title>
		<script type="text/javascript">
		
		    var div, xhr, btn;
			
			window.onload = function(){
				div = document.querySelector('div');
				btn = document.querySelector('button');
				
				btn.onclick = function(){
					// 버튼을 눌러야만 비동기통신 된다.
					xhr = new XMLHttpRequest();
					
					// 통신이벤트
					xhr.onreadystatechange = function(){
						
						// 통신이 성공했을 때
						console.log(xhr.status); // 없는파일 - 404숫자 결과 알려줌(클라측) // 문법에러 - 500(서버측)
						// 300번 - 페이지의 이동 (클라측)(이건잘못된게 아님) 리다이렉트
						
						
						// 콘솔에 찍힘
						// 총 4번 호출됨
						// 상태변화가 있을때 호출됨
						// 총 5번의 상태에서 4번 변화했다.
						// console.log(xhr.responseText);
						
						// 제일 마지막에 처리 -> 4번
						if(xhr.readyState==4){
							
							// 통신이 성공했을 때
							// -> 통신의 상태코드 받을 수 있다.
							console.log(xhr.status); // 정상수행하면 200번대
 							
							// console.log(xhr.responseText);
							div.innerHTML = xhr.responseText;
						}
						
						
						// 통신객체 이벤트 상태확인
						// ▶ readyState
						//    → console.log(xhr.readyState);
						//   【 readyState의 값은 다음과 같은 상태를 정의 】
						//      0: UNSET - 요청이 생성된 상태로 아직 서버에 요청을 보내지 않았습니다.
						//      1: OPENED - open() 함수가 호출된 상태로, 요청이 초기화되었습니다.
						//      2: HEADERS_RECEIVED - send() 함수 호출 후, 서버에 요청한 결과의 Header를 수신한 상태입니다.
						//      3: LOADING - send() 함수 호출 후, 서버에 요청한 결과를 받아오는 중입니다.
						//      4: DONE - 서버에 요청한 결과를 받은 상태이며, 결과는 성공이거나 실패했음을 알 수 있습니다.
						
						
						// 통신 실패냐 성공이이냐 상태
						// ▶ status
						//   → xhr.status
						//     Informational responses (100–199) → 요청보내기 전 (보이지도 않다.)
						//     Successful responses    (200–299) → 정상수행 - 200 OK!
						//     Redirection messages    (300–399) → 페이지 이동 (클라측) (이건 잘못)
						//     Client error responses  (400–499) → 없는 파일 (클라측) - 404 Not Found / 405 - 허용되어있지 않은 메서드 (post -> get)
						//     Server error responses  (500–599) → 문법 에러 (서버측) - 500~503


					}
					
					// get방식 / post방식
					xhr.open('get','ex02.jsp');
					xhr.send();
				}
				
				// ▶ 통신을 수행하기 위한 객체
				// xhr = new XMLHttpRequest();
				
				// ▶ 객체에 정보를 줌
				// xhr.open('get','ex01.jsp');
				
				// ▶ send를 해야만 비동기통신이 된다.
				// xhr.send();
				
				
			}
		
		
		</script>
	</head>
	<body>
		<h1>ex05 page</h1>
		<button>통신</button>
		<div></div>
	</body>
</html>